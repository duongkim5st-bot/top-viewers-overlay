<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Top Viewers Overlay</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800;900&display=swap" rel="stylesheet">

<style>
:root{
  --w: 360px;

  --bg: #6f7276;
  --bg-row: #7c7f83;
  --bg-header: #64676b;

  --text: #f2f4f7;
  --muted: #d0d3d8;

  --green: #19ffb4;
}

*{ box-sizing:border-box; }
body{
  margin:0;
  background: transparent;
  font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: var(--text);
}

.card{
  width: var(--w);
  background: var(--bg);
  border-radius: 16px;
  overflow: hidden;
}

/* ===== HEADER ===== */
.head{
  padding: 10px 12px 8px;
  background: var(--bg-header);
  position: relative;
}

/* Twitch logo g√≥c ph·∫£i */
.twitchCorner{
  position:absolute;
  right: 10px;
  top: 10px;
  width: 30px;
  height: 30px;
  border-radius: 10px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(145,70,255,.25);
}
.twitchCorner svg{ width: 18px; height: 18px; }

.title{
  font-size: 14px;
  font-weight: 900;
  letter-spacing: .5px;
  padding-right: 44px;
}
.title b{ color: var(--green); }

.badges{
  margin-top: 6px;
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}
.badge{
  font-size: 10px;
  font-weight: 800;
  padding: 4px 8px;
  border-radius: 999px;
  background: #555;
}
.badge.live{
  background: rgba(25,255,180,.2);
  color: var(--green);
}

/* ===== TABLE ===== */
.table{
  padding: 8px 10px;
}

.hdr{
  display:grid;
  grid-template-columns: 30px 1fr 46px 86px;
  font-size: 11px;
  font-weight: 800;
  color: var(--muted);
  margin-bottom: 6px;
}
.prizeHdr{ text-align:center; }

.rows{
  display:flex;
  flex-direction:column;
  gap: 6px;
}

.row{
  display:grid;
  grid-template-columns: 30px 1fr 46px 86px;
  align-items:center;
  padding: 8px;
  background: var(--bg-row);
  border-radius: 10px;
}

.rk{
  text-align:center;
  font-weight: 900;
  font-size: 12px;
}

/* ===== GRADIENT CH·ªÆ ===== */
@keyframes colorShift{
  0%{ background-position: 0% 50%; }
  50%{ background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}

.name,
.prize{
  font-weight: 900;
  background: linear-gradient(
    90deg,
    #ffd24a,
    #19ffb4,
    #9146ff,
    #ffd24a
  );
  background-size: 300% 100%;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  animation: colorShift 6s linear infinite;
}

.name{
  font-size: 13px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.time{
  font-size: 11px;
  font-weight: 700;
  text-align:right;
  color: var(--muted);
}

.prize{
  font-size: 12px;
  text-align:center;
}

/* TOP 1 n·ªïi b·∫≠t nh·∫•t */
.row.top1 .name,
.row.top1 .prize{
  animation-duration: 2.5s;
  filter: drop-shadow(0 0 8px rgba(255,210,74,.35));
}

/* TOP 2‚Äì3 v·ª´a */
.row.top2 .name,
.row.top2 .prize,
.row.top3 .name,
.row.top3 .prize{
  animation-duration: 4s;
}

/* 4‚Äì10 ch·∫≠m h∆°n */
.row:not(.top1):not(.top2):not(.top3) .name,
.row:not(.top1):not(.top2):not(.top3) .prize{
  animation-duration: 7s;
}

/* ===== FOOTER ===== */
.foot{
  padding: 8px 10px;
  font-size: 10px;
  color: var(--muted);
  display:flex;
  justify-content:space-between;
}
</style>
</head>

<body>
<div class="card">

  <div class="head">
    <div class="twitchCorner">
      <svg viewBox="0 0 24 24">
        <path fill="#9146FF" d="M4 3h18v12l-5 5h-4l-2 2H8v-2H4V3z"/>
        <path fill="#fff" d="M6 5v12h4v2l2-2h5l3-3V5H6zm5 8H9V8h2v5zm5 0h-2V8h2v5z"/>
      </svg>
    </div>

    <div class="title">üèÜ <b>TOP VIEWERS</b> ‚Äì THIS MONTH</div>
    <div class="badges">
      <span class="badge live">Real time only</span>
      <span class="badge" id="resetText">Reset ‚Ä¶</span>
    </div>
  </div>

  <div class="table">
    <div class="hdr">
      <div>#</div>
      <div>Viewer</div>
      <div>Time</div>
      <div class="prizeHdr">Prize (MCoins)</div>
    </div>
    <div class="rows" id="rows"></div>
  </div>

  <div class="foot">
    <span id="status">Loading‚Ä¶</span>
    <span id="updated">Updated: ‚Äî</span>
  </div>

</div>

<script>
/* ===== CONFIG ‚Äì GI·ªÆ SCRIPT C≈® ===== */
const WEBAPP_URL =
"https://script.google.com/macros/s/AKfycbyoYia8jIipN-Hq95blwQ8dkimXdy8uoNp_bvq1Ie1l7ZeQB0_QRMjBqsx7gwWg-kej8A/exec";
const REFRESH_MS = 15000;

const $rows = document.getElementById("rows");
const $status = document.getElementById("status");
const $updated = document.getElementById("updated");
const $resetText = document.getElementById("resetText");

const esc = s => String(s ?? "").replace(/[&<>"']/g, m =>
  ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m])
);

function rowClass(rank){
  if(rank===1) return "row top1";
  if(rank===2) return "row top2";
  if(rank===3) return "row top3";
  return "row";
}

function render(data){
  const list = data.top10 || [];
  $rows.innerHTML = "";

  list.forEach(x=>{
    const rank = Number(x.rank||0);
    const name = esc(x.username||"-");
    const time = Number(x.season_points||0); // gi·ªØ logic c≈©
    const prize = Number(x.prize_mcoins||0).toLocaleString("en-US");

    const div = document.createElement("div");
    div.className = rowClass(rank);
    div.innerHTML = `
      <div class="rk">${rank}</div>
      <div class="name" title="${name}">${name}</div>
      <div class="time">${time}m</div>
      <div class="prize">${prize}</div>
    `;
    $rows.appendChild(div);
  });

  if(data.reset_rule) $resetText.textContent = data.reset_rule;
  $updated.textContent = "Updated: " + (data.updated_at || "‚Äî");
  $status.textContent = "Live ranking";
}

async function load(){
  try{
    const res = await fetch(WEBAPP_URL, { cache:"no-store" });
    const data = await res.json();
    render(data);
  }catch(e){
    $status.textContent = "Load failed";
  }
}

load();
setInterval(load, REFRESH_MS);
</script>
</body>
</html>
